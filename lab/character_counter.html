<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文字数カウント | Kagetica Lab</title>

    <!-- OGP -->
    <meta property="og:title" content="文字数カウント＆文章チェッカー | Kagetica Lab">
    <meta property="og:description" content="執筆の進捗確認・分析のための『文字数カウント＆文章チェッカー』。漢字比率や文末重複などを可視化。">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://kagetica.net/lab/character_counter.html">
    <meta property="og:image" content="https://kagetica.net/assets/mozicount_opg.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@kagetica">
    <!-- Favicon -->
    <link rel="icon" href="../assets/icon.png" type="image/png">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700;900&family=Shippori+Mincho:wght@400;500;600;700;800&family=JetBrains+Mono:wght@700&display=swap"
        rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        yellow: '#ffe400',
                        pink: '#e82065',
                        cyan: '#00f3ff',
                        matrix: '#00ff41',
                    },
                    fontFamily: {
                        mincho: ['"Shippori Mincho"', 'serif'],
                        gothic: ['"Noto Sans JP"', 'sans-serif'],
                        mono: ['"JetBrains Mono"', 'monospace'],
                    },
                }
            }
        }
    </script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Common Styles -->
    <link rel="stylesheet" href="../css/style.css">
    <style>
        body {
            background-color: var(--bg-color);
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 3px solid #000;
            box-shadow: 10px 10px 0 #000;
        }

        body.sf-mode .glass-panel {
            background: rgba(0, 0, 0, 0.8);
            border-color: var(--matrix);
            box-shadow: 0 0 15px var(--matrix);
            color: var(--matrix);
        }

        .text-area-custom {
            scrollbar-width: thin;
            scrollbar-color: #000 #f0f0f0;
        }

        body.sf-mode .text-area-custom {
            scrollbar-color: var(--matrix) #000;
        }
    </style>
</head>

<body class="loading">
    <canvas id="matrix-canvas"></canvas>

    <div class="sf-toggle" id="sf-toggle">
        <span class="sf-toggle-icon">SF</span>
    </div>

    <!-- Navigation (Static) -->
    <nav id="nav">
        <div class="nav-container">
            <a href="../index.html" class="logo-mark">
                <img src="../assets/icon.png" alt="Kagetica Icon">
            </a>
            <div class="nav-links">
                <a href="../index.html" class="vertical-text">Top</a>
                <a href="../profile.html" class="vertical-text">Profile</a>
                <a href="../news.html" class="vertical-text">News</a>
                <a href="../works.html" class="vertical-text active">Works</a>
                <a href="../schedule.html" class="vertical-text">Schedule</a>
                <a href="https://docs.google.com/forms/d/e/1FAIpQLSdXy8Z_p6V_h1B4Zc6mX7VfW6zY8v-J5z1zQ8P_z6-lq6q9g/viewform"
                    target="_blank" class="vertical-text">Contact</a>
            </div>
        </div>
    </nav>

    <div id="root"></div>

    <!-- React App -->
    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        const App = () => {
            const [text, setText] = useState("");
            const [isCopied, setIsCopied] = useState(false);
            const textareaRef = useRef(null);

            // Stats calculation
            const stats = useMemo(() => {
                const charCount = text.length;
                const charNoSpace = text.replace(/\s+/g, '').length;
                const lineCount = text === '' ? 0 : text.split(/\r\n|\r|\n/).length;
                const manuscriptPages = Math.ceil(charCount / 400);

                // Reading speeds
                const readingTime = Math.ceil(charCount / 600);
                const speakingTime = Math.ceil(charCount / 300);

                // 1. Ratio analysis (Kanji, Hiragana, Katakana)
                const kanji = (text.match(/[\u4E00-\u9FFF]/g) || []).length;
                const hiragana = (text.match(/[\u3040-\u309F]/g) || []).length;
                const katakana = (text.match(/[\u30A0-\u30FF]/g) || []).length;
                const other = charCount - (kanji + hiragana + katakana);
                const kanjiRatio = charCount > 0 ? Math.round((kanji / charCount) * 100) : 0;
                const hiraRatio = charCount > 0 ? Math.round((hiragana / charCount) * 100) : 0;

                // 2. Sentence checks
                const sentences = text.split(/[。！？]/).filter(s => s.trim().length > 0);
                const avgSentenceLength = sentences.length > 0 ? Math.round(charCount / sentences.length) : 0;
                const longSentences = sentences.filter(s => s.length > 60).length;

                // 3. Dialogue ratio
                const dialogueChars = (text.match(/「[^」]*」|『[^』]*』/g) || []).join('').length;
                const dialogueRatio = charCount > 0 ? Math.round((dialogueChars / charCount) * 100) : 0;

                // 4. Repeated end-of-sentence
                const endings = text.split(/[\n。！？]/).filter(s => s.trim().length > 0).map(s => {
                    const match = s.match(/[ぁ-んァ-ヶー]{2,4}$/);
                    return match ? match[0] : null;
                }).filter(Boolean);

                let repeatedEndings = [];
                let currentCount = 1;
                for (let i = 1; i < endings.length; i++) {
                    if (endings[i] === endings[i - 1]) {
                        currentCount++;
                        if (currentCount === 3) repeatedEndings.push(endings[i]);
                    } else {
                        currentCount = 1;
                    }
                }

                // 5. Keyword analysis (using Intl.Segmenter)
                let keywords = [];
                if (window.Intl && window.Intl.Segmenter && text.length > 0) {
                    const segmenter = new Intl.Segmenter('ja', { granularity: 'word' });
                    const segments = segmenter.segment(text);
                    const wordCounts = {};
                    for (const segment of segments) {
                        const word = segment.segment;
                        // Filter for likely nouns (simplified: 2+ chars, Kanji or Katakana)
                        if (word.length >= 2 && segment.isWordLike && /[\u4E00-\u9FFF\u30A0-\u30FF]/.test(word)) {
                            wordCounts[word] = (wordCounts[word] || 0) + 1;
                        }
                    }
                    keywords = Object.entries(wordCounts)
                        .sort((a, b) => b[1] - a[1])
                        .slice(0, 5);
                }

                return {
                    charCount,
                    charNoSpace,
                    lineCount,
                    manuscriptPages,
                    readingTime,
                    speakingTime,
                    ratios: { kanji, hiragana, katakana, other, kanjiRatio, hiraRatio },
                    sentences: { avg: avgSentenceLength, long: longSentences },
                    dialogueRatio,
                    repeatedEndings: [...new Set(repeatedEndings)],
                    keywords
                };
            }, [text]);

            const handleCopy = () => {
                navigator.clipboard.writeText(text);
                setIsCopied(true);
                setTimeout(() => setIsCopied(false), 2000);
            };

            const handleClear = () => {
                if (window.confirm("テキストを消去しますか？")) {
                    setText("");
                }
            };

            return (
                <main className="min-h-screen">
                    <header className="subpage-header">
                        <div className="container">
                            <h1 className="subpage-title">文字数カウント＆文章チェッカー</h1>
                            <p className="mt-4 font-gothic opacity-70">
                                執筆の進捗を確認し、文章の読みやすさを分析するための高機能ツールです。
                            </p>
                        </div>
                    </header>

                    <section className="section pb-20" style={{ paddingTop: 0 }}>
                        <div className="container">
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">

                                {/* Editor Area */}
                                <div className="lg:col-span-2 space-y-4">
                                    <div className="glass-panel p-6 flex flex-col h-[600px]">
                                        <div className="flex justify-between items-center mb-4">
                                            <span className="font-mono text-xs tracking-widest uppercase opacity-50">Editor</span>
                                            <div className="flex gap-4">
                                                <button
                                                    onClick={handleCopy}
                                                    className={`text-xs font-bold px-3 py-1 border border-black hover:bg-black hover:text-white transition-all ${isCopied ? 'bg-black text-white' : ''}`}
                                                    style={{ borderColor: 'currentColor' }}
                                                >
                                                    {isCopied ? "COPIED!" : "COPY"}
                                                </button>
                                                <button
                                                    onClick={handleClear}
                                                    className="text-xs font-bold px-3 py-1 border border-black hover:bg-black hover:text-white transition-all"
                                                    style={{ borderColor: 'currentColor' }}
                                                >
                                                    CLEAR
                                                </button>
                                            </div>
                                        </div>
                                        <textarea
                                            ref={textareaRef}
                                            value={text}
                                            onChange={(e) => setText(e.target.value)}
                                            className="flex-1 w-full bg-transparent resize-none focus:outline-none font-gothic leading-relaxed text-lg text-area-custom"
                                            placeholder="ここにテキストを入力してください..."
                                        />
                                    </div>
                                </div>

                                {/* Sidebar Stats */}
                                <div className="space-y-6">
                                    <div className="glass-panel p-6">
                                        <h3 className="font-mono text-sm tracking-widest border-b border-black mb-6 pb-2" style={{ borderColor: 'currentColor' }}>BASIC STATS</h3>
                                        <div className="grid grid-cols-2 gap-6">
                                            <StatItem label="全文字数" value={stats.charCount} unit="字" />
                                            <StatItem label="空白抜き" value={stats.charNoSpace} unit="字" />
                                            <StatItem label="行数" value={stats.lineCount} unit="行" />
                                            <StatItem label="原稿用紙" value={stats.manuscriptPages} unit="枚" />
                                        </div>
                                    </div>

                                    <div className="glass-panel p-6">
                                        <h3 className="font-mono text-sm tracking-widest border-b border-black mb-6 pb-2" style={{ borderColor: 'currentColor' }}>TEXT CHECKER</h3>
                                        <div className="space-y-6">
                                            {/* Ratios */}
                                            <div className="space-y-2">
                                                <div className="flex justify-between text-[10px] font-bold">
                                                    <span>漢字比率 (開閉率)</span>
                                                    <span className={stats.ratios.kanjiRatio > 40 ? "text-red-500" : stats.ratios.kanjiRatio < 20 ? "text-blue-500" : ""}>
                                                        {stats.ratios.kanjiRatio}% {stats.ratios.kanjiRatio > 40 ? "（硬め）" : stats.ratios.kanjiRatio < 20 ? "（和らかめ）" : "（理想的）"}
                                                    </span>
                                                </div>
                                                <div className="w-full h-2 bg-gray-100 rounded-full overflow-hidden flex">
                                                    <div className="h-full bg-black" style={{ width: `${stats.ratios.kanjiRatio}%` }} />
                                                    <div className="h-full bg-gray-400" style={{ width: `${stats.ratios.hiraRatio}%` }} />
                                                </div>
                                                <p className="text-[10px] opacity-50">理想：漢字30%前後</p>
                                            </div>

                                            {/* Sentences */}
                                            <div className="grid grid-cols-2 gap-4">
                                                <div className="flex flex-col">
                                                    <span className="text-[10px] opacity-70 mb-1">平均一文長</span>
                                                    <div>
                                                        <span className={`text-xl font-black font-mono ${stats.sentences.avg > 60 ? "text-red-500" : ""}`}>{stats.sentences.avg}</span>
                                                        <span className="text-[10px] ml-1 font-bold">字</span>
                                                    </div>
                                                </div>
                                                <div className="flex flex-col">
                                                    <span className="text-[10px] opacity-70 mb-1">長文(60字〜)</span>
                                                    <div>
                                                        <span className={`text-xl font-black font-mono ${stats.sentences.long > 0 ? "text-red-500" : ""}`}>{stats.sentences.long}</span>
                                                        <span className="text-[10px] ml-1 font-bold">箇所</span>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Dialogue */}
                                            <div className="space-y-2">
                                                <div className="flex justify-between text-[10px] font-bold">
                                                    <span>会話文比率</span>
                                                    <span>{stats.dialogueRatio}%</span>
                                                </div>
                                                <div className="w-full h-2 bg-gray-100 rounded-full overflow-hidden">
                                                    <div className="h-full bg-pink-500" style={{ width: `${stats.dialogueRatio}%` }} />
                                                </div>
                                            </div>

                                            {/* Repetition */}
                                            {stats.repeatedEndings.length > 0 && (
                                                <div className="p-3 bg-red-50 border border-red-100 rounded-lg animate-pulse">
                                                    <h4 className="text-[10px] font-bold text-red-600 mb-1">文末重複アラート</h4>
                                                    <p className="text-[10px] text-red-500 leading-tight">
                                                        同じ文末が3回以上連続しています：<br />
                                                        {stats.repeatedEndings.join(', ')}
                                                    </p>
                                                </div>
                                            )}

                                            {/* Keywords */}
                                            {stats.keywords.length > 0 && (
                                                <div className="pt-4 border-t border-black/10" style={{ borderColor: 'currentColor' }}>
                                                    <h4 className="text-[10px] font-bold opacity-50 mb-2 uppercase">Frequent Keywords</h4>
                                                    <div className="flex flex-wrap gap-2">
                                                        {stats.keywords.map(([word, count]) => (
                                                            <span key={word} className="text-[10px] bg-black/5 px-2 py-1 rounded-md font-bold">
                                                                {word} <span className="opacity-40">{count}</span>
                                                            </span>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    <div className="glass-panel p-6">
                                        <h3 className="font-mono text-sm tracking-widest border-b border-black mb-6 pb-2" style={{ borderColor: 'currentColor' }}>READING TIME</h3>
                                        <div className="space-y-6">
                                            <div className="flex justify-between items-end">
                                                <span className="text-sm opacity-70">推定読了時間</span>
                                                <div className="text-right">
                                                    <span className="text-3xl font-black font-mono">{stats.readingTime}</span>
                                                    <span className="text-sm ml-1 font-bold">分</span>
                                                </div>
                                            </div>
                                            <div className="flex justify-between items-end">
                                                <span className="text-sm opacity-70">推定朗読時間</span>
                                                <div className="text-right">
                                                    <span className="text-3xl font-black font-mono">{stats.speakingTime}</span>
                                                    <span className="text-sm ml-1 font-bold">分</span>
                                                </div>
                                            </div>
                                        </div>
                                        <p className="mt-6 text-[10px] leading-tight opacity-50 border-t border-black pt-4" style={{ borderColor: 'currentColor' }}>
                                            ※読了 600字/分、朗読 300字/分 で計算。
                                        </p>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </section>
                </main>
            );
        };

        const StatItem = ({ label, value, unit }) => (
            <div className="flex flex-col">
                <span className="text-xs opacity-50 mb-1">{label}</span>
                <div>
                    <span className="text-2xl font-black font-mono">{value.toLocaleString()}</span>
                    <span className="text-[10px] ml-1 font-bold">{unit}</span>
                </div>
            </div>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>

    <!-- Global Footer -->
    <footer className="footer">
        <div className="container">
            <div className="copyright">&copy; 2026 Yoshida Kagetica</div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="../js/main.js"></script>
</body>

</html>